import { Injectable } from '@angular/core';
import * as _ from 'lodash';
import { FORMAT } from './file-upload.model';
var FileUploadValidationService = /** @class */ (function () {
    function FileUploadValidationService() {
        this.format = FORMAT;
    }
    /**
     * Check file size. Return true if valid
     */
    FileUploadValidationService.prototype.isValidFileSize = function (fileSize, maxFileSize) {
        return fileSize <= maxFileSize;
    };
    /**
     * Check file mime or extension. Return true if valid
     */
    FileUploadValidationService.prototype.isValidExtension = function (file, formatConfig) {
        return ((formatConfig.jpg && this.isJpgFile(file)) ||
            (formatConfig.png && this.isPngFile(file)) ||
            (formatConfig.gif && this.isGifFile(file)) ||
            (formatConfig.csv && this.isCsvFile(file)) ||
            (formatConfig.tsv && this.isTsvFile(file)) ||
            (formatConfig.zip && this.isZipFile(file)) ||
            (formatConfig.txt && this.isTxtFile(file)) ||
            (formatConfig.doc && this.isDocFile(file)) ||
            (formatConfig.xsl && this.isXslFile(file)) ||
            (formatConfig.ppt && this.isPptFile(file)) ||
            (formatConfig.rtf && this.isRtfFile(file)) ||
            (formatConfig.pdf && this.isPdfFile(file)) ||
            (formatConfig.css && this.isCssFile(file)) ||
            (formatConfig.js && this.isJsFile(file)) ||
            (formatConfig.html && this.isHtmlFile(file)) ||
            (formatConfig.code && this.isCodeFile(file)));
    };
    FileUploadValidationService.prototype.getAllowedMime = function (formatConfig) {
        var mime = [];
        for (var format in formatConfig) {
            if (this.format[format]) {
                mime.push(this.format[format].mime);
            }
        }
        return _.union(mime);
    };
    FileUploadValidationService.prototype.checkFileWith = function (mimeTypes, validExts, file) {
        var fileExt = file.name
            .split('.')
            .pop()
            .toLowerCase();
        var isValidExt = (file.type === '' || mimeTypes.length === 0) &&
            validExts.includes(fileExt);
        var isValidMime = file.type && mimeTypes.includes(file.type);
        return isValidExt || isValidMime;
    };
    FileUploadValidationService.prototype.isJpgFile = function (file) {
        return this.checkFileWith(this.format.jpg.mime, this.format.jpg.exts, file);
    };
    FileUploadValidationService.prototype.isPngFile = function (file) {
        return this.checkFileWith(this.format.png.mime, this.format.png.exts, file);
    };
    FileUploadValidationService.prototype.isGifFile = function (file) {
        return this.checkFileWith(this.format.gif.mime, this.format.gif.exts, file);
    };
    FileUploadValidationService.prototype.isCsvFile = function (file) {
        return this.checkFileWith(this.format.csv.mime, this.format.csv.exts, file);
    };
    FileUploadValidationService.prototype.isTsvFile = function (file) {
        return this.checkFileWith(this.format.tsv.mime, this.format.tsv.exts, file);
    };
    FileUploadValidationService.prototype.isZipFile = function (file) {
        return this.checkFileWith(this.format.zip.mime, this.format.zip.exts, file);
    };
    FileUploadValidationService.prototype.isTxtFile = function (file) {
        return this.checkFileWith(this.format.txt.mime, this.format.txt.exts, file);
    };
    FileUploadValidationService.prototype.isDocFile = function (file) {
        return this.checkFileWith(this.format.doc.mime, this.format.doc.exts, file);
    };
    FileUploadValidationService.prototype.isXslFile = function (file) {
        return this.checkFileWith(this.format.xsl.mime, this.format.xsl.exts, file);
    };
    FileUploadValidationService.prototype.isPptFile = function (file) {
        return this.checkFileWith(this.format.ppt.mime, this.format.ppt.exts, file);
    };
    FileUploadValidationService.prototype.isRtfFile = function (file) {
        return this.checkFileWith(this.format.rtf.mime, this.format.rtf.exts, file);
    };
    FileUploadValidationService.prototype.isPdfFile = function (file) {
        return this.checkFileWith(this.format.pdf.mime, this.format.pdf.exts, file);
    };
    FileUploadValidationService.prototype.isCssFile = function (file) {
        return this.checkFileWith(this.format.css.mime, this.format.css.exts, file);
    };
    FileUploadValidationService.prototype.isJsFile = function (file) {
        return this.checkFileWith(this.format.js.mime, this.format.js.exts, file);
    };
    FileUploadValidationService.prototype.isHtmlFile = function (file) {
        return this.checkFileWith(this.format.html.mime, this.format.html.exts, file);
    };
    FileUploadValidationService.prototype.isCodeFile = function (file) {
        return this.checkFileWith(this.format.code.mime, this.format.code.exts, file);
    };
    FileUploadValidationService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FileUploadValidationService.ctorParameters = function () { return []; };
    return FileUploadValidationService;
}());
export { FileUploadValidationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS11cGxvYWQudmFsaWRhdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vdmVyaXRhcy11aS1saWJyYXJ5LyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvZmlsZS11cGxvYWQvZmlsZS11cGxvYWQvZmlsZS11cGxvYWQudmFsaWRhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxLQUFLLENBQUMsTUFBTSxRQUFRLENBQUM7QUFFNUIsT0FBTyxFQUVMLE1BQU0sRUFFUCxNQUFNLHFCQUFxQixDQUFDO0FBRTdCO0lBSUU7UUFDRSxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQ7O09BRUc7SUFDSSxxREFBZSxHQUF0QixVQUF1QixRQUFnQixFQUFFLFdBQW1CO1FBQzFELE9BQU8sUUFBUSxJQUFJLFdBQVcsQ0FBQztJQUNqQyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxzREFBZ0IsR0FBdkIsVUFDRSxJQUFVLEVBQ1YsWUFBb0M7UUFFcEMsT0FBTyxDQUNMLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsWUFBWSxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3hDLENBQUMsWUFBWSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVDLENBQUMsWUFBWSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQzdDLENBQUM7SUFDSixDQUFDO0lBRU0sb0RBQWMsR0FBckIsVUFBc0IsWUFBb0M7UUFDeEQsSUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLEtBQUssSUFBTSxNQUFNLElBQUksWUFBWSxFQUFFO1lBQ2pDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3JDO1NBQ0Y7UUFDRCxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkIsQ0FBQztJQUVPLG1EQUFhLEdBQXJCLFVBQ0UsU0FBbUIsRUFDbkIsU0FBbUIsRUFDbkIsSUFBVTtRQUVWLElBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJO2FBQ3RCLEtBQUssQ0FBQyxHQUFHLENBQUM7YUFDVixHQUFHLEVBQUU7YUFDTCxXQUFXLEVBQUUsQ0FBQztRQUVqQixJQUFNLFVBQVUsR0FDZCxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssRUFBRSxJQUFJLFNBQVMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO1lBQzVDLFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFOUIsSUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUUvRCxPQUFPLFVBQVUsSUFBSSxXQUFXLENBQUM7SUFDbkMsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVNLCtDQUFTLEdBQWhCLFVBQWlCLElBQVU7UUFDekIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLCtDQUFTLEdBQWpCLFVBQWtCLElBQVU7UUFDMUIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVPLDhDQUFRLEdBQWhCLFVBQWlCLElBQVU7UUFDekIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDNUUsQ0FBQztJQUVPLGdEQUFVLEdBQWxCLFVBQW1CLElBQVU7UUFDM0IsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUN2QixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQ3JCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFDckIsSUFBSSxDQUNMLENBQUM7SUFDSixDQUFDO0lBRU8sZ0RBQVUsR0FBbEIsVUFBbUIsSUFBVTtRQUMzQixPQUFPLElBQUksQ0FBQyxhQUFhLENBQ3ZCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFDckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUNyQixJQUFJLENBQ0wsQ0FBQztJQUNKLENBQUM7O2dCQTdJRixVQUFVOzs7O0lBOElYLGtDQUFDO0NBQUEsQUE5SUQsSUE4SUM7U0E3SVksMkJBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XHJcblxyXG5pbXBvcnQge1xyXG4gIEZpbGVVcGxvYWRGb3JtYXRDb25maWcsXHJcbiAgRk9STUFULFxyXG4gIEZvcm1hdEludGVyZmFjZVxyXG59IGZyb20gJy4vZmlsZS11cGxvYWQubW9kZWwnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRmlsZVVwbG9hZFZhbGlkYXRpb25TZXJ2aWNlIHtcclxuICBwcml2YXRlIGZvcm1hdDogRm9ybWF0SW50ZXJmYWNlO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuZm9ybWF0ID0gRk9STUFUO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgZmlsZSBzaXplLiBSZXR1cm4gdHJ1ZSBpZiB2YWxpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBpc1ZhbGlkRmlsZVNpemUoZmlsZVNpemU6IG51bWJlciwgbWF4RmlsZVNpemU6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIGZpbGVTaXplIDw9IG1heEZpbGVTaXplO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgZmlsZSBtaW1lIG9yIGV4dGVuc2lvbi4gUmV0dXJuIHRydWUgaWYgdmFsaWRcclxuICAgKi9cclxuICBwdWJsaWMgaXNWYWxpZEV4dGVuc2lvbihcclxuICAgIGZpbGU6IEZpbGUsXHJcbiAgICBmb3JtYXRDb25maWc6IEZpbGVVcGxvYWRGb3JtYXRDb25maWdcclxuICApOiBib29sZWFuIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIChmb3JtYXRDb25maWcuanBnICYmIHRoaXMuaXNKcGdGaWxlKGZpbGUpKSB8fFxyXG4gICAgICAoZm9ybWF0Q29uZmlnLnBuZyAmJiB0aGlzLmlzUG5nRmlsZShmaWxlKSkgfHxcclxuICAgICAgKGZvcm1hdENvbmZpZy5naWYgJiYgdGhpcy5pc0dpZkZpbGUoZmlsZSkpIHx8XHJcbiAgICAgIChmb3JtYXRDb25maWcuY3N2ICYmIHRoaXMuaXNDc3ZGaWxlKGZpbGUpKSB8fFxyXG4gICAgICAoZm9ybWF0Q29uZmlnLnRzdiAmJiB0aGlzLmlzVHN2RmlsZShmaWxlKSkgfHxcclxuICAgICAgKGZvcm1hdENvbmZpZy56aXAgJiYgdGhpcy5pc1ppcEZpbGUoZmlsZSkpIHx8XHJcbiAgICAgIChmb3JtYXRDb25maWcudHh0ICYmIHRoaXMuaXNUeHRGaWxlKGZpbGUpKSB8fFxyXG4gICAgICAoZm9ybWF0Q29uZmlnLmRvYyAmJiB0aGlzLmlzRG9jRmlsZShmaWxlKSkgfHxcclxuICAgICAgKGZvcm1hdENvbmZpZy54c2wgJiYgdGhpcy5pc1hzbEZpbGUoZmlsZSkpIHx8XHJcbiAgICAgIChmb3JtYXRDb25maWcucHB0ICYmIHRoaXMuaXNQcHRGaWxlKGZpbGUpKSB8fFxyXG4gICAgICAoZm9ybWF0Q29uZmlnLnJ0ZiAmJiB0aGlzLmlzUnRmRmlsZShmaWxlKSkgfHxcclxuICAgICAgKGZvcm1hdENvbmZpZy5wZGYgJiYgdGhpcy5pc1BkZkZpbGUoZmlsZSkpIHx8XHJcbiAgICAgIChmb3JtYXRDb25maWcuY3NzICYmIHRoaXMuaXNDc3NGaWxlKGZpbGUpKSB8fFxyXG4gICAgICAoZm9ybWF0Q29uZmlnLmpzICYmIHRoaXMuaXNKc0ZpbGUoZmlsZSkpIHx8XHJcbiAgICAgIChmb3JtYXRDb25maWcuaHRtbCAmJiB0aGlzLmlzSHRtbEZpbGUoZmlsZSkpIHx8XHJcbiAgICAgIChmb3JtYXRDb25maWcuY29kZSAmJiB0aGlzLmlzQ29kZUZpbGUoZmlsZSkpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEFsbG93ZWRNaW1lKGZvcm1hdENvbmZpZzogRmlsZVVwbG9hZEZvcm1hdENvbmZpZyk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IG1pbWUgPSBbXTtcclxuICAgIGZvciAoY29uc3QgZm9ybWF0IGluIGZvcm1hdENvbmZpZykge1xyXG4gICAgICBpZiAodGhpcy5mb3JtYXRbZm9ybWF0XSkge1xyXG4gICAgICAgIG1pbWUucHVzaCh0aGlzLmZvcm1hdFtmb3JtYXRdLm1pbWUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gXy51bmlvbihtaW1lKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2hlY2tGaWxlV2l0aChcclxuICAgIG1pbWVUeXBlczogc3RyaW5nW10sXHJcbiAgICB2YWxpZEV4dHM6IHN0cmluZ1tdLFxyXG4gICAgZmlsZTogRmlsZVxyXG4gICk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgZmlsZUV4dCA9IGZpbGUubmFtZVxyXG4gICAgICAuc3BsaXQoJy4nKVxyXG4gICAgICAucG9wKClcclxuICAgICAgLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgY29uc3QgaXNWYWxpZEV4dCA9XHJcbiAgICAgIChmaWxlLnR5cGUgPT09ICcnIHx8IG1pbWVUeXBlcy5sZW5ndGggPT09IDApICYmXHJcbiAgICAgIHZhbGlkRXh0cy5pbmNsdWRlcyhmaWxlRXh0KTtcclxuXHJcbiAgICBjb25zdCBpc1ZhbGlkTWltZSA9IGZpbGUudHlwZSAmJiBtaW1lVHlwZXMuaW5jbHVkZXMoZmlsZS50eXBlKTtcclxuXHJcbiAgICByZXR1cm4gaXNWYWxpZEV4dCB8fCBpc1ZhbGlkTWltZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNKcGdGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgodGhpcy5mb3JtYXQuanBnLm1pbWUsIHRoaXMuZm9ybWF0LmpwZy5leHRzLCBmaWxlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNQbmdGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgodGhpcy5mb3JtYXQucG5nLm1pbWUsIHRoaXMuZm9ybWF0LnBuZy5leHRzLCBmaWxlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNHaWZGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgodGhpcy5mb3JtYXQuZ2lmLm1pbWUsIHRoaXMuZm9ybWF0LmdpZi5leHRzLCBmaWxlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNDc3ZGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgodGhpcy5mb3JtYXQuY3N2Lm1pbWUsIHRoaXMuZm9ybWF0LmNzdi5leHRzLCBmaWxlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNUc3ZGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgodGhpcy5mb3JtYXQudHN2Lm1pbWUsIHRoaXMuZm9ybWF0LnRzdi5leHRzLCBmaWxlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNaaXBGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgodGhpcy5mb3JtYXQuemlwLm1pbWUsIHRoaXMuZm9ybWF0LnppcC5leHRzLCBmaWxlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNUeHRGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgodGhpcy5mb3JtYXQudHh0Lm1pbWUsIHRoaXMuZm9ybWF0LnR4dC5leHRzLCBmaWxlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNEb2NGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgodGhpcy5mb3JtYXQuZG9jLm1pbWUsIHRoaXMuZm9ybWF0LmRvYy5leHRzLCBmaWxlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNYc2xGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgodGhpcy5mb3JtYXQueHNsLm1pbWUsIHRoaXMuZm9ybWF0LnhzbC5leHRzLCBmaWxlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNQcHRGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgodGhpcy5mb3JtYXQucHB0Lm1pbWUsIHRoaXMuZm9ybWF0LnBwdC5leHRzLCBmaWxlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNSdGZGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgodGhpcy5mb3JtYXQucnRmLm1pbWUsIHRoaXMuZm9ybWF0LnJ0Zi5leHRzLCBmaWxlKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBpc1BkZkZpbGUoZmlsZTogRmlsZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY2hlY2tGaWxlV2l0aCh0aGlzLmZvcm1hdC5wZGYubWltZSwgdGhpcy5mb3JtYXQucGRmLmV4dHMsIGZpbGUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpc0Nzc0ZpbGUoZmlsZTogRmlsZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY2hlY2tGaWxlV2l0aCh0aGlzLmZvcm1hdC5jc3MubWltZSwgdGhpcy5mb3JtYXQuY3NzLmV4dHMsIGZpbGUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpc0pzRmlsZShmaWxlOiBGaWxlKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jaGVja0ZpbGVXaXRoKHRoaXMuZm9ybWF0LmpzLm1pbWUsIHRoaXMuZm9ybWF0LmpzLmV4dHMsIGZpbGUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpc0h0bWxGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgoXHJcbiAgICAgIHRoaXMuZm9ybWF0Lmh0bWwubWltZSxcclxuICAgICAgdGhpcy5mb3JtYXQuaHRtbC5leHRzLFxyXG4gICAgICBmaWxlXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpc0NvZGVGaWxlKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNoZWNrRmlsZVdpdGgoXHJcbiAgICAgIHRoaXMuZm9ybWF0LmNvZGUubWltZSxcclxuICAgICAgdGhpcy5mb3JtYXQuY29kZS5leHRzLFxyXG4gICAgICBmaWxlXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iXX0=